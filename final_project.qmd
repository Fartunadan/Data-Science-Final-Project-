---
title: "Final Project"
author: "Fartun, Daija, and Kaela"
format: html
embed-resources: true
execute:
  warning: false
  message: false
editor: visual
---

# Rent Burden in America

```{r}
#| message: false
#| warning: false
#| echo: false # how do I hide this code?
knitr::include_graphics("image01.avif")
```

## Problem Statement:

Housing affordability has reached a critical juncture for American renters.

-   Between 2021 and 2023, the number of cost-burdened renter households those spending more than 30% of their income on rent and utilities climbed to an unprecedented 22.6 million, with 12.1 million households severely burdened by spending over half their income on housing.

-   Nearly half of all renter households now face cost burden, and these impacts fall disproportionately across racial lines, exacerbating existing inequalities.

This escalating crisis threatens not only individual financial stability but also broader economic health, as families sacrifice spending on healthcare, education, and savings to maintain shelter. Understanding the drivers and patterns of rent burden is essential for policymakers, housing advocates, and community planners to develop targeted interventions. A predictive model addressing rent burden can identify at-risk populations, forecast future trends, and inform evidence-based policies to prevent millions more households from falling into financial precarity. Without such tools, responses remain reactive rather than preventive, leaving vulnerable communities increasingly exposed to housing instability and its cascading consequences.

## Research Question: Predicting Household Rent Burden

**Primary Research Question:** Can we develop a model that adequately predicts a household's rent burden status using socioeconomic and demographic characteristics?

**Secondary Research Question:** Which variables are the most important in predicting the extent to which a household is rent burdened?

*Model Development:*

-   What combination of socioeconomic and demographic factors best predicts rent burden status?

-   How accurately can we classify households into burden categories (not burdened, burdened, severely burdened)?

-   Which modeling approaches (Linear regression, decision tree, random forest, etc.) provide optimal predictive performance?

## Data

The data were pulled from the IPUMS ACS 2023 microdata and the sample is limited to individuals that indicated they rent their dwelling. The dataset needs to be collapsed so that the unit of observation is the household.

```{r}
#Note: in this section, we need to clean the dataset, collapse it to the household level and then separate it into training and testing data. Then, we can do 2-3 visuals for exploratory data analysis.

library(tidyverse)
library(tidymodels)
library(rpart.plot)
library(vip)
library(haven)

data <- read_dta("data/ACS_extract.dta")
acs2023 <- data |>
  filter(ownershpd == 22 & hhincome > 0) |> #keep those who rent "with cash" and those with positive household income
  select(-cbserial, -year, -sample, -gq, -ownershp, -ownershpd, -multgend, -perwt, -related, -raced, -hispand, empstatd)

#Note: we have information on county fips but that's useless without the state fips added. Also, ACS apparently doesn't report on all counties so i'm not sure how useful it would be to create that new variable anyway. Just checked and i think there's enough variation that we can create a state/county fips variable and drop the countyfip once it's done since it's useless alone.

#it seems like population density is more helpful for saying where a person is because people with the same state-county fips have the same population density
#make note of unordered categorical variables
  # hhtype, cbhhtype, region, statefip, countyfip, metro, city, multigend (might want to drop this), sex, marst, race, hispan, citizen, hcovany, educ, empstat, 
#how to use strata and cluster?
# might want to create an overcrowded variable which represents if there are less bedrooms in the household than the number of adults, but might not be necessary
# might need to recode bedrooms because wtf ("to get the actual number of bedrooms, users must subtract 1 from the value of BEDROOMS")
#pernum == 1 is the "head of household" but we will probably have to create many new variables to account for differences across households. can drop pernum after creating those variables.
# stopping at relate for now, we've reached the person-level variables and need to figure out how to transform them


# half-baked ideas: proportion of household that is female, mean age of household, number of adults in household, proportion of household that is white, proportion of household that is hispanic, marital status of head of household (hhtype includes a summary of the structure of the household so hopefully that's fine), proportion of citizens in household, race of the head of household, number or percentage with health insurance coverage, average educational attainment among adults in household, number of adults employed in household, 
# confirm there is a variable that is just the number of people in the household

acs_household <- acs2023 |>
  group_by(serial) |>
  summarise(prop_female = mean(sex == 2, na.rm = TRUE),
            mean_age = mean(age, na.rm = TRUE),
            prop_adult = mean(age >= 18, na.rm = TRUE),
            prop_white = mean(race == 1, na.rm = TRUE),
            prop_black = mean(race == 2, na.rm = TRUE),
            prop_ai_an = mean(race == 3, na.rm = TRUE),
            prop_asian = mean(race == 4| race == 5| race == 6, na.rm = TRUE),
            prop_hispanic = mean(hispan >0 & hispan < 9, na.rm = TRUE),
            prop_citizen = mean(citizen == 0 | citizen == 1| citizen == 2, na.rm = TRUE),
            prop_healthcare = mean(hcovany == 2, na.rm = TRUE),
            prop_hsgrad = sum(educd >= 62 & age >= 18, na.rm = TRUE) / sum(age >=18), 
            prop_colgrad = sum(educd >= 101 & age >= 18, na.rm = TRUE) / sum(age >=18),
            prop_empstat = sum (empstat == 1  & age >= 16, na.rm = TRUE)/ sum(age >=16),
            total_hrs = sum(uhrswork, na.rm = TRUE))


#Next steps: merge to 


#create rent burden variables 

#the above code is taking forever to run for me, can someone check to see if it works?
```

## Models

```{r}
#This is where we'll create a recipe or two for our outcome variables. One will use the dummy as the outcome and drop the factor, and the other will use the factor as the outcome and drop the dummy. I think in the above section, after creating these two variables, we should drop the rent variable and the household income variable because we want to predict rent burden and if we had that information we'd just be able to predict it.

#setseed
#split data to training and testing (default)
#recipe:
  #think of steps to include in the recipe

#model 1: Decision tree w/ dummy variable : 3 hyper parameters(cost complexity, treedepth,min n  )

#Model 2: Decision tree w/ factor variable 


#model 3: Either Lasso or elastic net ; justify reason for model
# tune for penalty -- suggesting elastic net 






```

## Analysis

```{r}

```

## Findings/Results

## Conclusions and Recommendations
